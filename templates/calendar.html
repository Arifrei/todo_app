{% extends 'base.html' %}

{% block content %}
<div id="calendar-page" class="calendar-page">
    <section id="calendar-month-card" class="calendar-month card">
        <div class="calendar-month-nav">
            <button class="btn-icon" id="calendar-prev-month" aria-label="Previous month"><i class="fa-solid fa-chevron-left"></i></button>
            <div class="calendar-month-label-wrap">
                <div id="calendar-month-label" class="calendar-month-label"></div>
                <div class="calendar-month-sub">Click: quick add â€¢ Double-click: full view</div>
            </div>
            <button class="btn-icon" id="calendar-next-month" aria-label="Next month"><i class="fa-solid fa-chevron-right"></i></button>
        </div>
        <div class="calendar-weekdays">
            <span>Sun</span><span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span>
        </div>
        <div id="calendar-month-grid" class="calendar-month-grid"></div>
    </section>

    <!-- Quick Add Section (appears on single click) -->
    <section id="calendar-quick-add-panel" class="calendar-quick-add-panel is-hidden">
        <div class="calendar-quick-add-header">
            <div id="calendar-quick-add-date" class="calendar-quick-add-date">Select a day</div>
            <button class="btn-icon" id="calendar-quick-add-close" aria-label="Close"><i class="fa-solid fa-times"></i></button>
        </div>
        <div class="calendar-quick-add-input-row">
            <textarea id="calendar-month-quick-input" class="form-control" rows="2" placeholder="Type your task and press Enter" disabled></textarea>
        </div>
        <div class="quick-hint">
            Type your task and press <kbd>Enter</kbd>. Use <strong>$</strong> <strong>#</strong> <strong>></strong> <strong>@</strong> <strong>!</strong> <strong>*</strong> <strong>-</strong>
            <button class="link-btn" id="calendar-quick-help-toggle">Show syntax guide</button>
        </div>
        <div class="calendar-syntax-guide is-hidden" id="calendar-quick-syntax-guide">
            <div class="syntax-guide-row"><strong>$</strong> Event (e.g., <code>$ Meeting @3pm</code>)</div>
            <div class="syntax-guide-row"><strong>#Name</strong> Create phase or <code>Task #Work</code> to assign</div>
            <div class="syntax-guide-row"><strong>>Name</strong> Create group or <code>Task >ProjectA</code> to assign</div>
            <div class="syntax-guide-row"><strong>@</strong> Time (e.g., <code>@3pm-5pm</code>)</div>
            <div class="syntax-guide-row"><strong>!</strong> Priority (e.g., <code>!h</code> !m !l)</div>
            <div class="syntax-guide-row"><strong>*</strong> Reminder (e.g., <code>*30</code> for 30min before)</div>
            <div class="syntax-guide-row"><strong>-</strong> Disable rollover (prevents task from rolling to next day)</div>
        </div>
    </section>

    <section id="calendar-day-view" class="calendar-day-view is-hidden">
        <header class="calendar-header">
            <div class="calendar-date-nav">
                <button class="btn-icon" id="calendar-prev-day" aria-label="Previous day"><i class="fa-solid fa-chevron-left"></i></button>
                <div class="calendar-date-display">
                    <div id="calendar-day-label" class="calendar-day-label">Pick a day</div>
                    <div class="calendar-day-sub">
                        <input type="date" id="calendar-date-picker" class="calendar-date-picker" disabled>
                        <button class="btn btn-secondary btn-small" id="calendar-today-btn">Today</button>
                    </div>
                </div>
                <button class="btn-icon" id="calendar-next-day" aria-label="Next day"><i class="fa-solid fa-chevron-right"></i></button>
            </div>
            <div class="calendar-actions">
                <button class="btn btn-secondary btn-icon-text" id="calendar-back-month">
                    <i class="fa-solid fa-calendar-days"></i><span class="btn-text">Back</span>
                </button>
                <div class="calendar-actions-menu">
                    <button class="btn btn-secondary btn-icon-only" id="calendar-menu-btn" aria-label="More options" title="More options">
                        <i class="fa-solid fa-ellipsis-vertical"></i>
                    </button>
                    <div class="calendar-dropdown-menu" id="calendar-dropdown-menu">
                        <button class="calendar-menu-item" id="calendar-enable-notify">
                            <i class="fa-solid fa-bell"></i> Enable Notifications
                        </button>
                        <button class="calendar-menu-item" id="calendar-rollover-btn">
                            <i class="fa-solid fa-rotate"></i> Run Rollover
                        </button>
                        <button class="calendar-menu-item" id="calendar-send-digest">
                            <i class="fa-solid fa-envelope"></i> Email Digest
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <section class="calendar-quick-add card">
            <div class="calendar-input-row">
                <div class="quick-add-input-wrapper">
                    <textarea id="calendar-quick-input" class="form-control" rows="2" placeholder="Pick a day, then add entries" disabled></textarea>
                    <div id="calendar-autocomplete" class="calendar-autocomplete is-hidden"></div>
                </div>
                <button class="btn-icon calendar-help-btn" id="calendar-help-btn" title="Show syntax help">
                    <i class="fa-solid fa-circle-question"></i>
                </button>
            </div>
            <div class="quick-hint" id="calendar-syntax-hint">
                Start typing... Tap <i class="fa-solid fa-circle-question"></i> or press <kbd>Ctrl+Space</kbd> for syntax help
            </div>
        </section>

        <section class="calendar-board card">
            <div id="calendar-events" class="calendar-events"></div>
        </section>
    </section>

    <!-- Calendar Prompt Modal -->
    <div id="calendar-prompt-modal" class="calendar-prompt-modal is-hidden">
        <div class="calendar-prompt-content card">
            <h3 id="calendar-prompt-title">Input</h3>
            <p id="calendar-prompt-message" class="calendar-prompt-message"></p>
            <input id="calendar-prompt-input" class="form-control" type="text" value="">
            <div class="calendar-prompt-actions">
                <button class="btn btn-secondary btn-small" id="calendar-prompt-cancel">Cancel</button>
                <button class="btn btn-primary btn-small" id="calendar-prompt-save">Save</button>
            </div>
        </div>
    </div>

    <!-- Calendar Time Edit Modal -->
    <div class="modal" id="calendar-time-modal">
        <div class="modal-content">
            <h2>Edit Time</h2>
            <p id="calendar-time-title" style="color: var(--text-muted); margin-top: -0.25rem;"></p>
            <div class="form-group">
                <label>Start time</label>
                <input type="text" id="calendar-time-start" class="form-control" placeholder="e.g., 3:30pm or 15:30">
            </div>
            <div class="form-group">
                <label>End time (optional)</label>
                <input type="text" id="calendar-time-end" class="form-control" placeholder="e.g., 5:00pm">
            </div>
            <div class="modal-actions">
                <button class="btn" id="calendar-time-cancel">Cancel</button>
                <button class="btn btn-primary" id="calendar-time-save">Save</button>
            </div>
        </div>
    </div>

    <!-- Link Note Modal (shared with list view) -->
    <div class="modal" id="link-note-modal">
        <div class="modal-content">
            <h2>Link Note</h2>
            <p id="link-note-task-label" style="margin-top: -0.25rem; color: var(--text-muted);"></p>
            <div class="form-group">
                <label>Choose an existing note</label>
                <div id="link-note-list" class="note-chooser"></div>
            </div>
            <div class="form-group">
                <label>Create a new note</label>
                <input type="text" id="link-note-new-title" class="form-control" placeholder="New note title (optional)">
            </div>
            <div class="modal-actions">
                <button class="btn" onclick="closeLinkNoteModal()">Cancel</button>
                <button class="btn btn-secondary" onclick="createAndLinkNote()">Create & Link</button>
                <button class="btn btn-primary" onclick="saveLinkedNote()">Attach Selected</button>
            </div>
        </div>
    </div>
</div>

<script>
    window.USER_TIMEZONE = '{{ default_timezone or "America/New_York" }}';
</script>
{% endblock %}
